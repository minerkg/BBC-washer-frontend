<div class="p-grid p-justify-center p-align-center p-mt-5">
  <div class="p-col-12 p-md-8 p-lg-6">
    <p-card styleClass="p-shadow-24">
      <div class="p-fluid p-mb-4">
        <div *ngIf="washers && washers.length > 0; else noWashers">
          <!-- Search Bar -->
          <div class="p-d-flex p-ai-center p-mb-3">
            <span class="p-input-icon-left" [style]="{ 'width': '250px', 'margin-bottom': '0.5rem' }">
              <i class="pi pi-search"></i>
              <input
                type="text"
                pInputText
                placeholder="Search washers..."
                [(ngModel)]="washerSearchQuery"
                style="width: 100%;"
              />
            </span>
          </div>

          <!-- Washer Table -->
          <p-table
            [value]="filteredWashers"
            [paginator]="true"
            [rows]="10"
            [globalFilterFields]="['name', 'status']"
            [tableStyle]="{ 'min-width': '50rem' }"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Capacity</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-washer>
              <tr>
                <td>{{ washer.id }}</td>
                <td>{{ washer.name }}</td>
                <td>{{ washer.capacity }} kg</td>
                <td>
                  <p-tag [value]="washer.status" [severity]="getSeverity(washer.status)"></p-tag>
                </td>
                <td>
                  <div class="p-d-flex p-ai-center">
                    <p-button
                      icon="pi pi-pencil"
                      styleClass="p-button-sm p-button-info"
                      (onClick)="editWasher(washer)"
                      [style]="{ 'margin-right': '0.5rem' }"
                    ></p-button>
                    <p-button
                      *ngIf="isAdmin && washer.status !== 'DECOMMISSIONED'"
                      icon="pi pi-power-off"
                      styleClass="p-button-sm p-button-danger"
                      (onClick)="confirmDecommission(washer.id)"
                    ></p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptyMessage">
              <tr>
                <td colspan="5">No washers found.</td>
              </tr>
            </ng-template>
          </p-table>

          <!-- Add Washer Button Below Table -->
          <div class="p-mt-4">
            <p-button
              label="Add Washer"
              icon="pi pi-plus"
              (onClick)="displayAddDialog = true"
              [style]="{ width: '175px' }"
            ></p-button>
          </div>
        </div>

        <ng-template #noWashers>
          <div class="p-message p-message-info mt-3" style="display: block;">
            <div class="p-message-wrapper">
              <span class="p-message-icon pi pi-info-circle"></span>
              <span class="p-message-text">No washers currently registered.</span>
            </div>
          </div>
        </ng-template>

      </div>
    </p-card>
  </div>
</div>

<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '60vw' }" [baseZIndex]="1000"></p-confirmDialog>

<p-dialog
  header="Edit Washer"
  [(visible)]="displayEditDialog"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="p-fluid">
    <div class="p-field">
      <label for="editWasherName">Name</label>
      <input id="editWasherName" type="text" pInputText [(ngModel)]="selectedWasher.name"/>
    </div>
    <div class="p-field mt-4">
      <label for="editWasherCapacity">Capacity (kg)</label>
      <input id="editWasherCapacity" type="number" pInputText [(ngModel)]="selectedWasher.capacity"/>
    </div>
    <div class="p-field mt-4">
      <label for="editWasherStatus">Status</label>
      <p-dropdown
        class="mt-4"
        id="editWasherStatus"
        [options]="washerStatusesForEdit"
        [(ngModel)]="selectedWasher.status"
        placeholder="Select a Status"
      ></p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="displayEditDialog = false"
      styleClass="p-button-text"
    ></p-button>
    <p-button label="Save" icon="pi pi-check" (onClick)="updateWasher()"></p-button>
  </ng-template>
</p-dialog>

<p-dialog
  header="Add Washer"
  [(visible)]="displayAddDialog"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [draggable]="false"
  [resizable]="false"
  (onHide)="resetNewWasherForm()"
>
  <div class="p-fluid">
    <div class="p-field">
      <label for="washerName">Name</label>
      <input id="washerName" type="text" pInputText [(ngModel)]="newWasher.name" required/>
    </div>
    <div class="p-field mt-4">
      <label for="washerCapacity">Capacity (kg)</label>
      <input id="washerCapacity" type="number" pInputText [(ngModel)]="newWasher.capacity" required/>
    </div>
    <div class="p-field mt-4">
      <label for="washerStatus">Status</label>
      <p-dropdown
        id="washerStatus"
        [options]="washerStatuses"
        [(ngModel)]="newWasher.status"
        placeholder="Select a Status"
        required
      ></p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="displayAddDialog = false"
      styleClass="p-button-text"
    ></p-button>
    <p-button label="Add" icon="pi pi-plus" (onClick)="addWasher()" autoFocus></p-button>
  </ng-template>
</p-dialog>
