<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div *ngIf="isAdmin">
  <div class="mb-3">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input
        type="text"
        pInputText
        placeholder="Search users..."
        [(ngModel)]="searchQuery"
      />
    </span>
  </div>

  <p-table
    [value]="filteredUsers"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5,10,20]"
    [globalFilterFields]="['username','first_name','last_name','email']"
    class="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Username</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Role</th>
        <th>Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.username }}</td>
        <td>{{ user.first_name }} {{ user.last_name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.phone }}</td>
        <td>
          <p-dropdown
            [options]="roleOptions"
            [(ngModel)]="selectedRoles[user.username]"
            [style]="{ width: '150px', position: 'relative' }"
            appendTo="body"
            [overlayOptions]="{ style: { zIndex: 10000 } }"
          ></p-dropdown>
        </td>
        <td>
          <p-button
            icon="pi pi-save"
            (onClick)="confirmUpdateRole(user)"
            styleClass="p-button-sm p-button-success"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div>
  <p-button
    label="Add User"
    icon="pi pi-user-plus"
    (onClick)="showRegisterDialog = true"
  ></p-button>

  <p-dialog [(visible)]="showRegisterDialog" [modal]="true" [draggable]="false" (onHide)="onRegisterDialogHide()">
    <app-register
      [inDialog]="true"
      (cancelDialog)="showRegisterDialog = false"
    ></app-register>
  </p-dialog>
</div>
